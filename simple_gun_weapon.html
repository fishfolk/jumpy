<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Simple Gun Weapon - Fish Fight Documentation</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="code_of_conduct.html"><strong aria-hidden="true">1.1.</strong> Code of Conduct</a></li></ol></li><li class="chapter-item expanded "><a href="gameplay.html"><strong aria-hidden="true">2.</strong> Gameplay</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="controls.html"><strong aria-hidden="true">2.1.</strong> Controls</a></li><li class="chapter-item expanded "><a href="items.html"><strong aria-hidden="true">2.2.</strong> Items</a></li><li class="chapter-item expanded "><a href="multiplayer.html"><strong aria-hidden="true">2.3.</strong> Multiplayer</a></li></ol></li><li class="chapter-item expanded "><a href="mechanics.html"><strong aria-hidden="true">3.</strong> Mechanics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="physics.html"><strong aria-hidden="true">3.1.</strong> Physics</a></li><li class="chapter-item expanded "><a href="environmental_weapons.html"><strong aria-hidden="true">3.2.</strong> Environmental Weapons</a></li></ol></li><li class="chapter-item expanded "><a href="netcode.html"><strong aria-hidden="true">4.</strong> Netcode</a></li><li class="chapter-item expanded "><a href="editor.html"><strong aria-hidden="true">5.</strong> Editor</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">6.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contributing_code.html"><strong aria-hidden="true">6.1.</strong> Contributing Code</a></li><li class="chapter-item expanded "><a href="simple_gun_weapon.html" class="active"><strong aria-hidden="true">6.2.</strong> Simple Gun Weapon</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Fish Fight Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/fishfight/FishFight" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#simple-gun-weapon" id="simple-gun-weapon">Simple Gun Weapon</a></h1>
<p>This section will walk through the process of adding a new gun weapon to Fish Fight, using a sniper weapon as an example.</p>
<h2><a class="header" href="#planning" id="planning">Planning</a></h2>
<p>Before jumping into the games code, it is a good idea to do some planning about what you want your new weapon to do. I determined that my sniper weapon should have the following properties:</p>
<ul>
<li>High bullet speed</li>
<li>Large recoil</li>
<li>2 bullets</li>
</ul>
<h2><a class="header" href="#implementation" id="implementation">Implementation</a></h2>
<p>Open your cloned &quot;FishFight&quot; directory using your code editor of choice.</p>
<h3><a class="header" href="#the-item-definition" id="the-item-definition">The item definition</a></h3>
<p>To add an item or, in this case, a weapon to the game, you will first have to define the item in a data file. These files are located in
<code>assets/items</code> and will typically have the same name as the item's id. Since we are creating a sniper rifle, we can give this file the 
name <code>sniper_rifle.json</code>. This path to the file must also be added to the file <code>assets/items.json</code>, so that game will know where to look
for it. This is done by simply adding the path to the file, relative to the <code>items.json</code> file, to the array within. In this case, the path
that we add will be <code>items/sniper_rifle.json</code>.</p>
<p>Now, it is time to define the weapons parameters inside the <code>items.json</code> file. Begin by creating a new object and adding
the id (<code>sniper_rifle</code>) and the item type (<code>weapon</code>).</p>
<p>Every item that we add will also need a set of sprite parameters (<code>SpriteParams</code>) that define the sprite that will be drawn
when the item is on the ground, before being picked up by the player. Typically, it will be enough to include a texture id here,
as things like sprite size will most often be defined in the texture's entry in the <code>assets/textures.json</code> file.</p>
<p>We will also need to define a collider size, that will be the size of the collider used when checking if a player is close enough
to the item to pick it up:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;sniper_rifle&quot;,
  &quot;type&quot;: &quot;weapon&quot;,
  &quot;sprite&quot;: {
    &quot;texture&quot;: &quot;musket&quot;
  },
  &quot;collider_size&quot;: {
    &quot;x&quot;: 16,
    &quot;y&quot;: 16
  }
}
</code></pre>
<p>That is all the required data for the item part of our definition, so now it is time need to add the parameters required for weapon item variants.</p>
<p>We have quite a few options for customization here that can be explored by looking at the <code>WeaponParams</code> struct in the source code. We are required 
to define at least the <code>ActiveEffectParams</code>, which holds the parameters of the effect that will be instantiated when the weapon is used to attack,
and a <code>WeaponAnimationParams</code>, which holds the parameters of the animation players that will be used to animate and draw the weapon when it is
equipped. We also wanted our rifle to have two bullets and a heavy recoil, so we should also define these parameters. We should also specify a
cooldown for our weapon, which governs the interval between shots, and an attack duration, which controls the length of time that the player is
locked in the attack state (input blocked), after an attack. We should also add a sound effect, to be played when the weapon is used. We will also
have to add an effect offset, which is the offset from the weapons position to the point where the weapons effect will originate.</p>
<p>Now, it is time to define the parameters for the affect that will be instantiated when we fire the gun. There are several variants to
choose from, or a new one can be implemented, either as a new variant of <code>ActiveEffectKind</code> or as an implementation of the <code>WeaponEffectCoroutine</code>
type. In our case, however, there is already a perfect fit; the <code>Projectile</code> variant.</p>
<p>We will want to specify a projectile speed, a projectile range and a specification for how the projectile should be drawn. A projectile can be
drawn as a simple colored shape or using a texture. We will use a texture and we will also color the projectile by setting a tint:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;sniper_rifle&quot;,
  &quot;type&quot;: &quot;weapon&quot;,
  &quot;sprite&quot;: {
    &quot;texture&quot;: &quot;musket&quot;
  },
  &quot;uses&quot;: 2,
  &quot;cooldown&quot;: 1.5,
  &quot;attack_duration&quot;: 1.0,
  &quot;recoil&quot;: 1400.0,
  &quot;sound_effect&quot;: &quot;shoot&quot;,
  &quot;collider_size&quot;: {
    &quot;x&quot;: 64,
    &quot;y&quot;: 24
  },
  &quot;effect_offset&quot;: {
    &quot;x&quot;: 64,
    &quot;y&quot;: 16
  },
  &quot;effects&quot;: {
    &quot;type&quot;: &quot;projectile&quot;,
    &quot;projectile&quot;: {
      &quot;type&quot;: &quot;sprite&quot;,
      &quot;sprite&quot;: {
        &quot;texture&quot;: &quot;small_projectile&quot;,
        &quot;size&quot;: {
          &quot;x&quot;: 8,
          &quot;y&quot;: 4
        },
        &quot;tint&quot;: {
          &quot;r&quot;: 0.9,
          &quot;g&quot;: 0.75,
          &quot;b&quot;: 0.12,
          &quot;a&quot;: 1.0
        }
      }
    },
    &quot;range&quot;: 600.0,
    &quot;speed&quot;: 25.0
  },
  &quot;animation&quot;: {
    &quot;texture&quot;: &quot;musket&quot;,
    &quot;animations&quot;: [
      {
        &quot;id&quot;: &quot;idle&quot;,
        &quot;row&quot;: 0,
        &quot;frames&quot;: 1,
        &quot;fps&quot;: 1
      },
      {
        &quot;id&quot;: &quot;attack&quot;,
        &quot;row&quot;: 1,
        &quot;frames&quot;: 3,
        &quot;fps&quot;: 15
      }
    ]
  },
  &quot;effect_animation&quot;: {
    &quot;texture&quot;: &quot;musket&quot;,
    &quot;animations&quot;: [
      {
        &quot;id&quot;: &quot;attack_effect&quot;,
        &quot;row&quot;: 2,
        &quot;frames&quot;: 4,
        &quot;fps&quot;: 12
      }
    ]
  }
}
</code></pre>
<h2><a class="header" href="#texture" id="texture">Texture</a></h2>
<p>It is important to make sure that your weapon is able to be visually distinguished between the other weapons in the game. When I added the sniper rifle to the <code>ITEMS</code> array, I copied all of the data from existing musket weapon, changing only the <code>tiled_name</code> and <code>constructor</code>. To give my sniper weapon a new texture, I will also need to change the <code>gun</code> texture in the <code>textures</code> field. Currently, the <code>gun</code> texture is set to <code>assets/Whale/Gun(92x32).png</code>. I'll open this file with my pixel editor of choice, <a href="https://www.aseprite.org/">Aseprite</a> (<a href="https://www.gimp.org/">GIMP</a> would also work fine).</p>
<p><img src="assets/open_gun_texture.png" alt="open_gun_texture" /></p>
<p>I don't consider myself an artist so I'm just going to modify the hue of the golden part of the gun texture to a reddish color. First I'll select a color range and adjust the threshold to select only the golden part of the gun texture.</p>
<p><img src="assets/select_gun_colors.png" alt="select_gun_colors" /></p>
<p>Then I'll adjust the hue of the selected colors to turn all of the gold color red.</p>
<p><img src="assets/adjust_gun_hue.png" alt="adjust_gun_hue" /></p>
<p>This texture is now distinguishable from the other gun textures in the game.</p>
<p>This, of course, is just one way of distinguishing the texture from the other textures in the game. Feel free to copy and modify textures using your own methods, or if you feel inclined, make your own unique texture for your weapon!</p>
<p>Now, all that remains is to add the new texture to the game. This is done by copying the texture file to the <code>assets/textures/items</code> directory and adding an entry to the file <code>assets/textures.json</code>.</p>
<p>Assuming a texture file name of <code>SniperRifle(92x32).png</code>, the following entry should be added to <code>assets/textures.json</code>:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;sniper_rifle&quot;,
  &quot;path&quot;: &quot;textures/items/SniperRifle(92x32).png&quot;,
  &quot;type&quot;: &quot;spritesheet&quot;,
  &quot;sprite_size&quot;: {
    &quot;x&quot;: 92,
    &quot;y&quot;: 32
  }
}
</code></pre>
<p>You will also have to change your weapons data file, so that it references this new texture, in stead of <code>&quot;musket&quot;</code>. This is done by changing the <code>texture</code> fields of your weapons <code>sprite</code> and <code>animation</code> members to <code>&quot;sniper_rifle&quot;</code>.</p>
<h2><a class="header" href="#testing" id="testing">Testing</a></h2>
<p>The last thing we need to do is put our new weapon in the game and test it! Fish Fight's levels are defined in json files in the <code>assets/maps</code> directory. For testing items, there is a test level in the game defined in a file called <code>test_level.json</code>. Open this file.</p>
<p>In this file you will see a long list of item entries containing data about items that are placed in the level. The easiest way to add your new weapon to this level is to replace the <code>name</code> field of one of other items currently in the level with the id of your new weapon (referred to as <code>your_weapon</code> throughout this chapter). Here is the entry for my sniper weapon.</p>
<pre><code class="language-json">...
{
    &quot;draworder&quot;:&quot;topdown&quot;,
    &quot;id&quot;:5,
    &quot;name&quot;:&quot;items&quot;,
    &quot;objects&quot;:[
        ...
        {
            &quot;height&quot;:0,
            &quot;id&quot;:147,
            &quot;name&quot;:&quot;sniper&quot;,
            &quot;point&quot;:true,
            &quot;rotation&quot;:0,
            &quot;type&quot;:&quot;item&quot;,
            &quot;visible&quot;:true,
            &quot;width&quot;:0,
            &quot;x&quot;:400,
            &quot;y&quot;:690
        },
        ...
    ],
    ...
}
</code></pre>
<p>If you followed all of these steps correctly, your new weapon should be in the game. Run the game using <code>cargo run</code>, then select the test level. You should see your gun in the level and be able to try it out.</p>
<p><img src="assets/sniper_weapon_test.gif" alt="sniper_weapon_test" /></p>
<p>Now all you need to do is modify the values in <code>src/items/your_weapon.rs</code> until the weapon feels right to you! Then you are ready to make a pull request.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="contributing_code.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="contributing_code.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
